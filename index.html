<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö—Ç–æ —è? - –ò–≥—Ä–∞ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/peerjs/1.4.7/peerjs.min.js"></script>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë§</text></svg>">
    
    <!-- –ú–µ—Ç–∞-—Ç–µ–≥–∏ –¥–ª—è iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#4361ee">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üë§</text></svg>">
    <link rel="preconnect" href="https://0.peerjs.com">
    <link rel="dns-prefetch" href="https://0.peerjs.com">
</head>
<body>
    <div class="container">
        <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
        <div id="loginScreen" class="screen active">
            <div class="header">
                <h1><i class="fas fa-users"></i> –ö—Ç–æ —è?</h1>
                <p class="subtitle">–ò–≥—Ä–∞ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ (3-6 —á–µ–ª–æ–≤–µ–∫)</p>
            </div>
            
            <div class="content">
                <div class="card">
                    <h2><i class="fas fa-user"></i> –í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è</h2>
                    <input type="text" id="playerName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ê–Ω–Ω–∞" maxlength="15" autocomplete="off">
                    
                    <div class="actions">
                        <button id="createRoomBtn" class="btn btn-primary">
                            <i class="fas fa-plus-circle"></i> –°–æ–∑–¥–∞—Ç—å –∫–æ–º–Ω–∞—Ç—É
                        </button>
                        
                        <div class="divider">
                            <span>–∏–ª–∏</span>
                        </div>
                        
                        <div class="join-section">
                            <input type="text" id="roomCode" placeholder="–ö–æ–¥ –∫–æ–º–Ω–∞—Ç—ã (6 —Å–∏–º–≤–æ–ª–æ–≤)" maxlength="6" autocomplete="off" pattern="[A-Z0-9]{6}" title="6 –∑–∞–≥–ª–∞–≤–Ω—ã—Ö –±—É–∫–≤ –∏–ª–∏ —Ü–∏—Ñ—Ä">
                            <button id="joinRoomBtn" class="btn btn-secondary">
                                <i class="fas fa-sign-in-alt"></i> –í–æ–π—Ç–∏
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="instructions">
                    <h3><i class="fas fa-info-circle"></i> –ö–∞–∫ –∏–≥—Ä–∞—Ç—å:</h3>
                    <ol>
                        <li>–û–¥–∏–Ω –∏–≥—Ä–æ–∫ —Å–æ–∑–¥–∞—ë—Ç –∫–æ–º–Ω–∞—Ç—É –∏ –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–¥</li>
                        <li>–î—Ä—É–≥–∏–µ –∏–≥—Ä–æ–∫–∏ –≤–≤–æ–¥—è—Ç —ç—Ç–æ—Ç –∫–æ–¥</li>
                        <li>–ö–æ–≥–¥–∞ –≤—Å–µ –ø–æ–¥–∫–ª—é—á–∞—Ç—Å—è (3-6 —á–µ–ª–æ–≤–µ–∫), –Ω–∞—á–∏–Ω–∞–µ–º –∏–≥—Ä—É</li>
                        <li>–ö–∞–∂–¥—ã–π –ø–∏—à–µ—Ç —Å–ª–æ–≤–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞</li>
                        <li>–í—Å–µ –≤–∏–¥—è—Ç —Å–ª–æ–≤–∞ –¥—Ä—É–≥ –¥—Ä—É–≥–∞, –Ω–æ –Ω–µ —Å–≤–æ—ë</li>
                        <li>–£–≥–∞–¥—ã–≤–∞–π—Ç–µ —Å–≤–æ—ë —Å–ª–æ–≤–æ –ø–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º!</li>
                    </ol>
                    <p class="tech-info"><i class="fas fa-wifi"></i> –ò–≥—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ –ø—Ä—è–º–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –º–µ–∂–¥—É —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞–º–∏ (P2P)</p>
                    <p class="ios-warning" id="iosWarning" style="display: none; color: #f72585; margin-top: 10px; font-size: 0.9em;">
                        <i class="fas fa-mobile-alt"></i> –î–ª—è iPhone —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Safari –∏–ª–∏ Chrome
                    </p>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –ª–æ–±–±–∏ -->
        <div id="lobbyScreen" class="screen">
            <div class="header">
                <h1><i class="fas fa-door-open"></i> –ö–æ–º–Ω–∞—Ç–∞</h1>
                <div class="room-header">
                    <div class="room-code-display">
                        –ö–æ–¥: <span id="roomCodeDisplay" class="code">XXXXXX</span>
                        <button id="copyCodeBtn" class="btn-icon" title="–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="room-status">
                        <span id="playersCount">1</span>/6 –∏–≥—Ä–æ–∫–æ–≤
                    </div>
                </div>
            </div>
            
            <div class="content">
                <div class="card">
                    <h2><i class="fas fa-user-friends"></i> –ò–≥—Ä–æ–∫–∏ –≤ –∫–æ–º–Ω–∞—Ç–µ</h2>
                    <div id="playersList" class="players-list">
                        <!-- –ò–≥—Ä–æ–∫–∏ –±—É–¥—É—Ç –ø–æ—è–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
                    </div>
                    
                    <div class="lobby-controls">
                        <button id="startGameBtn" class="btn btn-primary btn-large" disabled>
                            <i class="fas fa-play"></i> –ù–∞—á–∞—Ç—å –∏–≥—Ä—É
                        </button>
                        <button id="backToGameBtn" class="btn btn-primary btn-large" style="display: none;">
                            <i class="fas fa-gamepad"></i> –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –∏–≥—Ä—É
                        </button>
                        <button id="leaveLobbyBtn" class="btn btn-secondary">
                            <i class="fas fa-sign-out-alt"></i> –ü–æ–∫–∏–Ω—É—Ç—å –∫–æ–º–Ω–∞—Ç—É
                        </button>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-comments"></i> –ß–∞—Ç –∫–æ–º–Ω–∞—Ç—ã</h2>
                    <div id="chatMessages" class="chat-messages">
                        <div class="message system">
                            <span class="time" id="currentTime">--:--</span>
                            –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–Ω–∞—Ç—É!
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="chatInput" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." maxlength="200">
                        <button id="sendMessageBtn" class="btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –≤–≤–æ–¥–∞ —Å–ª–æ–≤ -->
        <div id="wordScreen" class="screen">
            <div class="header">
                <h1><i class="fas fa-pencil-alt"></i> –ü–∏—à–µ–º —Å–ª–æ–≤–∞</h1>
                <p class="subtitle">–ö–∞–∂–¥—ã–π –ø–∏—à–µ—Ç —Å–ª–æ–≤–æ –¥–ª—è —Å–ª–µ–¥—É—é—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞</p>
            </div>
            
            <div class="content">
                <div class="card">
                    <h2>–•–æ–¥ –∏–≥—Ä–æ–∫–∞ <span id="currentPlayerNum">1</span> –∏–∑ <span id="totalPlayers">6</span></h2>
                    
                    <div class="progress-container">
                        <div class="progress-bar">
                            <div class="progress" id="progressBar"></div>
                        </div>
                        <div class="progress-text">
                            <span id="completedWords">0</span> —Å–ª–æ–≤ –Ω–∞–ø–∏—Å–∞–Ω–æ
                        </div>
                    </div>
                    
                    <div class="writing-info">
                        <div class="info-box">
                            <h3>–°–µ–π—á–∞—Å –ø–∏—à–µ—Ç:</h3>
                            <div class="player-name" id="currentWriter">–ê–Ω–Ω–∞</div>
                        </div>
                        <div class="info-box">
                            <h3>–ü–∏—à–µ—Ç —Å–ª–æ–≤–æ –¥–ª—è:</h3>
                            <div class="player-name highlight" id="targetPlayer">–ë–æ—Ä–∏—Å</div>
                        </div>
                    </div>
                    
                    <div class="word-input-section">
                        <div id="inputArea">
                            <input type="text" id="wordInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑—É" maxlength="30" autocomplete="off">
                            <button id="submitWordBtn" class="btn btn-primary">
                                <i class="fas fa-check"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                            </button>
                        </div>
                        
                        <div id="waitingArea" class="hidden">
                            <div class="waiting-message">
                                <i class="fas fa-spinner fa-spin"></i>
                                <p>–ñ–¥—ë–º, –ø–æ–∫–∞ <span id="waitingForPlayer">–ë–æ—Ä–∏—Å</span> –Ω–∞–ø–∏—à–µ—Ç —Å–ª–æ–≤–æ...</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="examples">
                        <p><i class="fas fa-lightbulb"></i> –ü—Ä–∏–º–µ—Ä—ã: 
                            <span class="example">–ö–æ—Ç</span>, 
                            <span class="example">–ë—ç—Ç–º–µ–Ω</span>, 
                            <span class="example">–¢–µ–ª–µ—Ñ–æ–Ω</span>, 
                            <span class="example">–ë–∞–ª–µ—Ä–∏–Ω–∞</span>,
                            <span class="example">–ê—Å—Ç—Ä–æ–Ω–∞–≤—Ç</span>
                        </p>
                        <p class="hint-small"><i class="fas fa-exclamation-circle"></i> –ù–µ –ø–∏—à–∏—Ç–µ –æ—Å–∫–æ—Ä–±–∏—Ç–µ–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞!</p>
                    </div>
                </div>
                
                <div class="connection-status">
                    <i class="fas fa-wifi" id="connectionIcon"></i>
                    <span id="connectionStatus">–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ</span>
                </div>
            </div>
        </div>

        <!-- –≠–∫—Ä–∞–Ω –∏–≥—Ä—ã -->
        <div id="gameScreen" class="screen">
            <div class="header">
                <h1><i class="fas fa-gamepad"></i> –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å!</h1>
                <p>–£–≥–∞–¥—ã–≤–∞–π—Ç–µ —Å–≤–æ—ë —Å–ª–æ–≤–æ –ø–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º</p>
            </div>
            
            <div class="content">
                <div class="card">
                    <h2><i class="fas fa-user"></i> –í—ã: <span id="myPlayerName">–ò–≥—Ä–æ–∫</span></h2>
                    
                    <div class="my-info">
                        <div class="secret-word">
                            <i class="fas fa-eye-slash"></i>
                            <h3>–í–∞—à–µ —Å–ª–æ–≤–æ —Å–∫—Ä—ã—Ç–æ</h3>
                        </div>
                        <p class="hint">–°–º–æ—Ç—Ä–∏—Ç–µ —Å–ª–æ–≤–∞ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –∏ —É–≥–∞–¥—ã–≤–∞–π—Ç–µ —Å–≤–æ—ë –ø–æ –ø–æ–¥—Å–∫–∞–∑–∫–∞–º –≤ —á–∞—Ç–µ!</p>
                        <p class="hint-small"><i class="fas fa-lightbulb"></i> –ü–æ–¥—Å–∫–∞–∑–∫–∞: –∑–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –¥—Ä—É–≥–∏–º –∏–≥—Ä–æ–∫–∞–º –æ —Å–≤–æ—ë–º —Å–ª–æ–≤–µ</p>
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-users"></i> –°–ª–æ–≤–∞ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤</h2>
                    <div id="otherPlayers" class="players-grid">
                        <!-- –°–ª–æ–≤–∞ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
                
                <div class="card">
                    <h2><i class="fas fa-comment-dots"></i> –ß–∞—Ç –∏–≥—Ä—ã</h2>
                    <div id="gameChatMessages" class="chat-messages">
                        <div class="message system">
                            <span class="time" id="gameTime">--:--</span>
                            –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å! –û–±—â–∞–π—Ç–µ—Å—å –≤ —á–∞—Ç–µ, —á—Ç–æ–±—ã —É–≥–∞–¥–∞—Ç—å —Å–≤–æ–∏ —Å–ª–æ–≤–∞!
                        </div>
                    </div>
                    <div class="chat-input">
                        <input type="text" id="gameChatInput" placeholder="–í–∞—à–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∞ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ..." maxlength="200">
                        <button id="sendGameMessageBtn" class="btn" title="–û—Ç–ø—Ä–∞–≤–∏—Ç—å">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
                
                <div class="game-controls">
                    <button id="newGameBtn" class="btn btn-primary">
                        <i class="fas fa-redo"></i> –ù–æ–≤–∞—è –∏–≥—Ä–∞
                    </button>
                    <button id="backToLobbyBtn" class="btn btn-secondary">
                        <i class="fas fa-home"></i> –í –ª–æ–±–±–∏
                    </button>
                </div>
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <h2 id="modalTitle">–ó–∞–≥–æ–ª–æ–≤–æ–∫</h2>
                <div id="modalMessage">
                    –°–æ–æ–±—â–µ–Ω–∏–µ
                </div>
                <div class="modal-actions">
                    <button id="modalCloseBtn" class="btn">–ó–∞–∫—Ä—ã—Ç—å</button>
                </div>
            </div>
        </div>

        <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
        <div id="notification" class="notification">
            <div class="notification-content">
                <i class="fas fa-bell notification-icon"></i>
                <span id="notificationText"></span>
            </div>
        </div>
    </div>

    <!-- iOS –ø–æ–ª–∏—Ñ–∏–ª–ª—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
        <!-- iOS –ø–æ–ª–∏—Ñ–∏–ª–ª—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ -->
    <script>
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –∏ –±—Ä–∞—É–∑–µ—Ä–∞
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        const isSafari = /^((?!chrome|android).)*safari/i.test(navigator.userAgent);
        const isChromeIOS = /CriOS/.test(navigator.userAgent);
        const isWebKit = isIOS || isSafari;
        
        console.log('Device info:', {
            isIOS: isIOS,
            isSafari: isSafari,
            isChromeIOS: isChromeIOS,
            isWebKit: isWebKit,
            userAgent: navigator.userAgent
        });
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–ª—è iOS
        if (isWebKit) {
            const iosWarning = document.getElementById('iosWarning');
            if (iosWarning) {
                iosWarning.style.display = 'block';
                if (isIOS && !isChromeIOS) {
                    iosWarning.innerHTML = '<i class="fas fa-mobile-alt"></i> –î–ª—è iPhone —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Chrome –∏–ª–∏ Telegram –±—Ä–∞—É–∑–µ—Ä';
                }
            }
        }
        
        // –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ WebRTC –ø–æ–¥–¥–µ—Ä–∂–∫–∏
        function checkWebRTCSupport() {
            const required = ['RTCPeerConnection', 'RTCSessionDescription', 'RTCIceCandidate'];
            
            // –ü–æ–ª–∏—Ñ–∏–ª–ª—ã –¥–ª—è Safari
            if (typeof RTCPeerConnection === 'undefined') {
                window.RTCPeerConnection = window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
            }
            
            const missing = required.filter(api => !window[api]);
            
            if (missing.length > 0 && isWebKit) {
                console.warn('Missing WebRTC APIs:', missing);
            }
            
            return missing.length === 0;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            if (!checkWebRTCSupport() && isWebKit) {
                console.log('WebRTC may have limited support on this iOS/Safari device');
            }
            
            // –§–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –∏–º–µ–Ω–∏
            document.getElementById('playerName').focus();
            
            // –ê–≤—Ç–æ–∑–∞–≥–ª–∞–≤–Ω—ã–µ –¥–ª—è –∫–æ–¥–∞ –∫–æ–º–Ω–∞—Ç—ã
            document.getElementById('roomCode').addEventListener('input', function(e) {
                this.value = this.value.toUpperCase().replace(/[^A-Z0-9]/g, '');
            });
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–º—è
            document.getElementById('playerName').addEventListener('input', function(e) {
                localStorage.setItem('whoami_playername', this.value);
            });
            
            // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–º—è
            const savedName = localStorage.getItem('whoami_playername');
            if (savedName) {
                document.getElementById('playerName').value = savedName;
            }
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ Enter
            document.getElementById('playerName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') document.getElementById('createRoomBtn').click();
            });
            
            document.getElementById('roomCode').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') document.getElementById('joinRoomBtn').click();
            });
        });
    </script>
    <script src="safari-fix.js"></script>
    <script src="game.js"></script>
</body>
</html>